# 交易配置文件
# 支持环境变量覆盖，例如：TRADING_ENVIRONMENT_INITIAL_CASH=2000000.0
trading:
  environment:
    # 股票池，将在运行时填充，可通过 TRADING_ENVIRONMENT_STOCK_POOL 覆盖
    stock_pool:
      - "600519.SH"  # 贵州茅台
      - "600036.SH"  # 招商银行
      - "601318.SH"  # 中国平安
    lookback_window: 60         # 回看窗口，可通过 TRADING_ENVIRONMENT_LOOKBACK_WINDOW 覆盖
    initial_cash: 1000000.0     # 初始资金，可通过 TRADING_ENVIRONMENT_INITIAL_CASH 覆盖
    commission_rate: 0.0005     # 手续费率 0.05%，可通过 TRADING_ENVIRONMENT_COMMISSION_RATE 覆盖
    stamp_tax_rate: 0.0005      # 印花税率 0.05%，可通过 TRADING_ENVIRONMENT_STAMP_TAX_RATE 覆盖
    risk_aversion: 0.01         # 风险厌恶系数（降低以减少过度惩罚），可通过 TRADING_ENVIRONMENT_RISK_AVERSION 覆盖
    max_drawdown_penalty: 1.0   # 最大回撤惩罚，可通过 TRADING_ENVIRONMENT_MAX_DRAWDOWN_PENALTY 覆盖

  cost_model:
    almgren_chriss:
      permanent_impact: 0.1     # 永久冲击系数，可通过 TRADING_COST_MODEL_ALMGREN_CHRISS_PERMANENT_IMPACT 覆盖
      temporary_impact: 0.05    # 临时冲击系数，可通过 TRADING_COST_MODEL_ALMGREN_CHRISS_TEMPORARY_IMPACT 覆盖

  data:
    provider: "qlib"            # 数据提供商 qlib 或 akshare，可通过 TRADING_DATA_PROVIDER 覆盖
    cache_enabled: true         # 是否启用缓存，可通过 TRADING_DATA_CACHE_ENABLED 覆盖
    cache_dir: "./data_cache"   # 缓存目录，可通过 TRADING_DATA_CACHE_DIR 覆盖

# 回撤控制配置
drawdown_control:
  enable: true  # 启用回撤控制

  # 基础回撤参数
  max_drawdown_threshold: 0.10        # 最大回撤阈值 10%
  drawdown_warning_threshold: 0.05    # 回撤警告阈值 5%

  # 风险控制参数
  drawdown_penalty_factor: 3.0        # 回撤惩罚因子
  risk_aversion_coefficient: 0.8      # 风险厌恶系数

  # 市场状态感知
  enable_market_regime_detection: true  # 启用市场状态检测

  # 训练相关参数
  max_training_drawdown: 0.12          # 训练过程最大允许回撤
  enable_adaptive_learning: true      # 启用自适应学习

backtest:
  freq: "1d"                    # 回测频率 1d 或 1min，可通过 BACKTEST_FREQ 覆盖
  rebalance_freq: "1d"          # 再平衡频率，可通过 BACKTEST_REBALANCE_FREQ 覆盖
  start_date: "2024-06-31"      # 回测开始日期，可通过 BACKTEST_START_DATE 覆盖
  end_date: "2025-06-31"        # 回测结束日期，可通过 BACKTEST_END_DATE 覆盖
  benchmark: "000300.SH"        # 基准指数（沪深300），可通过 BACKTEST_BENCHMARK 覆盖

# 风险管理配置
risk:
  enable_risk_control: true
  max_portfolio_concentration: 0.4
  max_single_position: 0.15
  min_cash_ratio: 0.05%

# 模型配置
model:
  transformer:
    d_model: 128
    n_heads: 8
    n_layers: 4
    d_ff: 512
    dropout: 0.1
    max_seq_len: 60
    n_features: 37   # 每只股票的特征数（与已训练模型一致）

  sac:
    actor_lr: 0.0003
    critic_lr: 0.0003
    alpha_lr: 0.0003
    lr_actor: 0.0003
    lr_critic: 0.0003
    lr_alpha: 0.0003
    gamma: 0.99
    tau: 0.005
    alpha: 0.2
    target_update_interval: 1
    automatic_entropy_tuning: true
    target_entropy: -3.0  # -action_dim
    buffer_size: 100000
    batch_size: 256
    hidden_size: 256
    hidden_dim: 256  # 隐藏层维度
    state_dim: 128   # Transformer输出维度（与已训练模型一致）
    action_dim: 3   # 3只股票

  training:
    n_episodes: 100  # 减少训练轮数用于测试
    eval_freq: 20
    patience: 20
    min_delta: 0.001